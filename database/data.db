SET DATESTYLE TO 'European';

CREATE TABLE LIBROS(
    ID_LIBRO SERIAL PRIMARY KEY,
    NOMBRE VARCHAR(200) UNIQUE,
    AUTOR VARCHAR(100),
    ANIO INT,
    CANTIDAD INT,
    ESTADO VARCHAR(100),
    GENERO VARCHAR(100)
);


CREATE TABLE USUARIOS(
    ID_USER SERIAL PRIMARY KEY,
    USERNAME VARCHAR(200) UNIQUE,
    PASSWORD VARCHAR(100),
    EMAIL VARCHAR(100), 
    BLOQUEO INT, 
    ROL INT NOT NULL
);

CREATE TABLE PRESTAMO(
    ID_PRESTAMO SERIAL PRIMARY KEY, 
    ID_USER INT NOT NULL, 
    ID_LIBRO INT NOT NULL, 
    DIA_PRESTAMO DATE, 
    DIA_ENTREGA DATE, 
    ENTREGADO INT,
    CONSTRAINT FK_USER
      FOREIGN KEY(ID_USER) 
	    REFERENCES USUARIOS(ID_USER),
    CONSTRAINT FK_LIBRO
      FOREIGN KEY(ID_LIBRO) 
	    REFERENCES LIBROS(ID_LIBRO)
);



INSERT INTO LIBROS(NOMBRE,AUTOR,ANIO,CANTIDAD,ESTADO,GENERO)VALUES('Estudio en escarlata','Arthur Conan Doyle',1887,100,'Disponible','Misterio');
INSERT INTO LIBROS(NOMBRE,AUTOR,ANIO,CANTIDAD,ESTADO,GENERO)VALUES('El signo de los cuatro','Arthur Conan Doyle',1890,100,'Disponible','Misterio');
INSERT INTO LIBROS(NOMBRE,AUTOR,ANIO,CANTIDAD,ESTADO,GENERO)VALUES('La niebla','Stephen King',1980,100,'Disponible','Terror');
INSERT INTO LIBROS(NOMBRE,AUTOR,ANIO,CANTIDAD,ESTADO,GENERO)VALUES('IT','Stephen King',1986,100,'Disponible','Terror');
INSERT INTO LIBROS(NOMBRE,AUTOR,ANIO,CANTIDAD,ESTADO,GENERO)VALUES('Don Quijote de la mancha','Miguel de Cervantes',1605,100,'Disponible','Novela');
SELECT * FROM LIBROS;

INSERT INTO USUARIOS(USERNAME,PASSWORD,EMAIL,BLOQUEO,ROL)VALUES('admin','admin123','libros@gmail.com',0,1);
INSERT INTO USUARIOS(USERNAME,PASSWORD,EMAIL,BLOQUEO,ROL)VALUES('joker','joker123','joker@gmail.com',0,0);
INSERT INTO USUARIOS(USERNAME,PASSWORD,EMAIL,BLOQUEO,ROL)VALUES('diego','diego123','diego@gmail.com',0,0);
INSERT INTO USUARIOS(USERNAME,PASSWORD,EMAIL,BLOQUEO,ROL)VALUES('maria','maria123','maria@gmail.com',0,0);
INSERT INTO USUARIOS(USERNAME,PASSWORD,EMAIL,BLOQUEO,ROL)VALUES('fer','fer123','fer@gmail.com',0,0);
INSERT INTO USUARIOS(USERNAME,PASSWORD,EMAIL,BLOQUEO,ROL)VALUES('pablito','pablito','pabloxd@gmail.com',1,0);

INSERT INTO PRESTAMO(ID_USER,ID_LIBRO,DIA_PRESTAMO,DIA_ENTREGA,ENTREGADO)VALUES(2,3,'18/12/2021','18/1/2022',1);
INSERT INTO PRESTAMO(ID_USER,ID_LIBRO,DIA_PRESTAMO,DIA_ENTREGA,ENTREGADO)VALUES(6,2,'25/2/2022','25/3/2022',0);
INSERT INTO PRESTAMO(ID_USER,ID_LIBRO,DIA_PRESTAMO,DIA_ENTREGA,ENTREGADO)VALUES(3,4,'3/5/2022','3/6/2022',1);
INSERT INTO PRESTAMO(ID_USER,ID_LIBRO,DIA_PRESTAMO,DIA_ENTREGA,ENTREGADO)VALUES(4,3,'4/7/2021','4/8/2022',1);

SELECT setval(pg_get_serial_sequence('usuarios', 'id_user'), coalesce(max(id_user), 0)+1 , false) FROM usuarios;
SELECT * FROM USUARIOS;